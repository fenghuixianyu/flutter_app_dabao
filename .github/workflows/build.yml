name: Flutter Build APK
on:
  workflow_dispatch: # æ‰‹åŠ¨è§¦å‘

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Code
        uses: actions/checkout@v3

      # 1. é…ç½® Java ç¯å¢ƒ
      - name: Setup Java
        uses: actions/setup-java@v3
        with:
          distribution: 'temurin'
          java-version: '17'

      # 2. é…ç½® Flutter ç¯å¢ƒ
      - name: Setup Flutter
        uses: subosito/flutter-action@v2
        with:
          flutter-version: '3.19.0' # æ¨èç¨³å®šç‰ˆ
          channel: 'stable'

      # 3. ğŸ” é»‘ç§‘æŠ€ï¼šå¦‚æœæ²¡ä¸Šä¼  android ç›®å½•ï¼Œè‡ªåŠ¨ç”Ÿæˆ
      - name: Create Android Project if Missing
        run: |
          if [ ! -d "android" ]; then
            echo "âš ï¸ Android folder not found. Generating scaffold..."
            flutter create . --platforms android
          fi

      # 4. å®‰è£…ä¾èµ–
      - name: Install Dependencies
        run: flutter pub get

      # 5. âœ¨ å¼€å§‹æ‰“åŒ… (æ‰“ Debug åŒ…ä»¥å…é™¤ç­¾åçƒ¦æ¼)
      # ä¹Ÿå°±æ˜¯ç”Ÿæˆçš„ APP å¯ä»¥ç›´æ¥å®‰è£…ï¼Œä½†ä¸èƒ½ä¸Šæ¶è°·æ­Œå•†åº—
      - name: Build APK
        run: flutter build apk --debug

      # 6. ä¸Šä¼ ç»“æœ
      - name: Upload APK
        uses: actions/upload-artifact@v4
        with:
          name: flutter-app-debug
          path: build/app/outputs/flutter-apk/app-debug.apk
